#!/usr/bin/env bash

update-bitwarden-cli() (
  URI='https://func.bitwarden.com/api/dl/?app=cli&platform=linux'
  if [[ ! -f $HOME/.local/bin/bitwarden ]]; then
    print-info "==> installing\n"
  else
    URI=$(bw update | sed -nr 's@You can download this update at (https://.*zip)$@\1@p')
    if [[ -n "${URI}" ]]; then
      print-info "==> upgrading\n"
    fi
  fi

  # install binary
  if [[ -n "${URI}" ]]; then
    (
      set -x
      curl -fLo /tmp/bw.zip "$URI"
      (
        cd "$HOME/.local/bin" || exit 1
        unzip -o /tmp/bw.zip
        chmod u+x bw
      )
      rm /tmp/bw.zip
    )
  fi
)

run-module true x86_64
